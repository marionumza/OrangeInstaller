#encoding: utf-8
from OpenOrange import *
from Report import Report
from Account import Account
import ListViewItem

        
ParentAccountTreeViewWindow = SuperClass("AccountTreeViewWindow", "SettingWindow", __file__)
class AccountTreeViewWindow(ParentAccountTreeViewWindow):

    def appendChildNodes(self, node, parent, tree):
        if tree.has_key(node):
            #alert(node)
            for child in tree[node]:
                item = AccountTreeViewNode(parent)
                item.setText( (child,self.accnames[child]) )
                item.window = self
                self.appendChildNodes(child, item, tree)

    def afterShowRecord(self):
        listview = self.getListView("TreeView")
        listview.setTreeMode()
        listview.setColumns((tr("Code"), tr("Name") ))
        tree = Account.getTree()
        self.accnames = Account.getNames(False)
        currentnode = listview
        self.appendChildNodes(None, listview, tree)
        
    def buttonClicked(self, buttonname):
        if (buttonname=="createReportSpec"):
            tree = Account.getTree()
            from ReportSpec import ReportSpec
            rs = ReportSpec()
            rs.autofill()
            from ReportSpecWindow import ReportSpecWindow
            rsw = ReportSpecWindow()
            rsw.setRecord(rs)
            rsw.open()        
        elif (buttonname=="pasteFatherAccs"):
            from PasteFatherAccounts import PasteFatherAccounts
            pfa = PasteFatherAccounts()
            pfa.run()
            

class AccountTreeViewNode(ListViewItem.ListViewItem):

    def selected(self):
        code = self.getText()[0]
        accrec = Account.bring(code)
        from AccountWindow import AccountWindow
        aw = AccountWindow()
        aw.setRecord(accrec)
        aw.open()        

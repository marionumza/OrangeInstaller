#encoding: utf-8
from OpenOrange import *
from MasterWindow import MasterWindow
from GenerateMailing import GenerateMailing

ParentMailingWindow = SuperClass("MailingWindow","TransactionWindow",__file__)
class MailingWindow(ParentMailingWindow):

    def ReplaceClauses(self):
        from Person import Person
        rec = self.getRecord()
        myPerson = Person()
        myPerson.Code = 1
        myPerson.load()
        rec.replaceNames(myPerson)
        rec.replaceClauses()

    def genMailing(self):
        message(tr('Starting mailing routine'))
        rut = GenerateMailing()
        rut.setBackground(True)
        rut.getRecord().Nr = self.getRecord().SerNr
        rut.open(False)
        self.refresh()

    def importHTML(self):
        import os
        fn = getOpenFileName()
        f = file(fn)
        html = f.read()
        pathdir = os.path.dirname(fn)
        self.getRecord().importHTML(html,False,pathdir)
        commit() #porque el refresh hace un rollback (SP)
        self.refresh()

    
    def afterEdit(self,fieldname):
        if (fieldname == "User"):
            self.getRecord().pasteUser()
        elif (fieldname == "MailCode"):
            self.getRecord().pasteMailCode()
        elif (fieldname == "TemplateCode"):
            self.getRecord().loadTemplate()
            
    def showGroupReport(self):
        from Report import Report
        from GroupListing import GroupListing
        report = GroupListing()
        report.getRecord().Group = self.getRecord().Group
        report.open(False)

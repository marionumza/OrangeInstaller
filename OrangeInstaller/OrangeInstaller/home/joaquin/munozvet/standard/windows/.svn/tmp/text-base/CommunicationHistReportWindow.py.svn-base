from OpenOrange import *

ParentCommunicationHistReportWindow = SuperClass("CommunicationHistReportWindow","ReportWindow",__file__)
class CommunicationHistReportWindow(ParentCommunicationHistReportWindow):

    def filterPasteWindow(self, fname):
        record = self.getRecord()
        if fname == "ShiftNr":
            if record.CashRegister:
                res  = "{Code} = s|%s| " % self.getRecord().CashRegister
                #res += "AND ({StartDate} >= d|%s| AND {EndDate} <= d|%s|)" %(record.FromDate,record.ToDate)
                if (not record.IncludeClosedEvents):
                    res += "AND ({Closed} = 0 OR {Closed} IS NULL)"
                return res
                
    def afterEdit(self,fieldname):
        report = self.getRecord()
        if (fieldname == "CustCode"):
            from Customer import Customer
            cust = Customer.bring(report.CustCode)
            if cust:
                nro = filter(lambda x : x.isdigit(),cust.Phone)
                report.Destination = "1" + nro[3:]
                

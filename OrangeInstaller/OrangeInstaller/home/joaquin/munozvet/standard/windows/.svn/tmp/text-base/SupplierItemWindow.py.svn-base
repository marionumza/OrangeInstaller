#encoding: utf-8
from OpenOrange import *

ParentSupplierItemWindow = SuperClass("SupplierItemWindow","Window",__file__)
class SupplierItemWindow(ParentSupplierItemWindow):
        
    def afterEdit(self, fieldname):
        ParentSupplierItemWindow.afterEdit(self, fieldname)
        record = self.getRecord()
        if (fieldname in ("RawPrice","Discount1", "Discount2", "Discount3","Discount4","Discount5")):
            record.genPrice()
        elif (fieldname == "SupCode"):
            record.pasteSupCode()
        elif (fieldname == "ArtCode"):
            record.pasteArtCode()
        elif (fieldname == "SupName"):
            if not record.SupCode:
                from NameSearchResult import NameSearchResult
                NameSearchResult.search("Supplier",record.SupName,self)

    def showSupplierItems(self):
        record = self.getRecord()
        from SupplierItemList import SupplierItemList
        report = SupplierItemList()
        report.getRecord().ArtCode = record.ArtCode
        report.open(False)

    def showHistory(self):
        from LogSettings import LogSettings
        ls = LogSettings.bring()
        if not ls.shouldLogEvents(self.getRecord().name()):
            message(tr("Record History has not been configured, check Settings/Register logging"))
        else:
            from RecordHistoryReport import RecordHistoryReport
            report = RecordHistoryReport()
            report.getRecord().TableName = self.getRecord().name()
            report.getRecord().recInternalId = self.getRecord().internalId
            report.getRecord().FromDate = date(1900,1,1)
            report.getRecord().ToDate = date(2100,1,1)
            report.open(False)